<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áœááŸ’áá˜á¶á“ á“á·á„á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹á”á»á‚áŸ’á‚á›á·á€</title>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --excellent: #10b981;
            --good: #f59e0b;
            --late: #ef4444;
            --dark: #1e293b;
        }

        body { font-family: 'Kantumruy Pro', sans-serif; background-color: #f1f5f9; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        
        .header-section { text-align: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        /* Groups Styling */
        .group-title { margin-top: 40px; padding-left: 15px; border-left: 5px solid; font-size: 1.2rem; }
        .grid-container { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px; }

        .staff-card {
            background: white; width: 150px; padding: 15px; border-radius: 12px;
            text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: 0.3s; position: relative;
        }

        .avatar { width: 70px; height: 70px; border-radius: 50%; margin: 0 auto 10px; overflow: hidden; border: 3px solid #eee; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        
        .name { font-size: 0.85rem; font-weight: bold; display: block; margin-bottom: 5px; }
        .count-badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; color: white; }

        /* Specific Colors */
        .excellent-border { border-left-color: var(--excellent); color: var(--excellent); }
        .good-border { border-left-color: var(--good); color: var(--good); }
        .late-border { border-left-color: var(--late); color: var(--late); }

        .bg-excellent { background: var(--excellent); }
        .bg-good { background: var(--good); }
        .bg-late { background: var(--late); }

        input[type="file"] { margin: 15px 0; padding: 10px; background: #e2e8f0; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <h2>ğŸ† á”áŸ’ášá–áŸá“áŸ’á’áœá¶á™áá˜áŸ’á›áŸƒáœááŸ’áá˜á¶á“á”á»á‚áŸ’á‚á›á·á€á”áŸ’ášá…á¶áŸ†áŸá”áŸ’áá¶á áŸ</h2>
        <input type="file" id="fileInput" accept=".xlsx, .xls, .csv">
        <p style="font-size: 0.9rem; color: #64748b;">áŸá¼á˜á”á‰áŸ’á…á¼á› File STAFF.xlsx áŠá¾á˜áŸ’á”á¸á˜á¾á›á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹áá¶á˜á€áŸ’ášá»á˜</p>
    </div>

    <div id="results" style="display:none;">
        <h3 class="group-title excellent-border">ğŸŒŸ á€áŸ’ášá»á˜á˜á€á˜á»á“á˜áŸ‰áŸ„á„ áŸ§:áŸ áŸ  (á˜áŸáŠá¶á™á˜á¶áŸ)</h3>
        <div class="grid-container" id="groupExcellent"></div>

        <h3 class="group-title good-border">âœ… á€áŸ’ášá»á˜á˜á€á…á“áŸ’á›áŸ„áŸ‡á˜áŸ‰áŸ„á„ áŸ§:áŸ áŸ  - áŸ§:áŸ áŸ¥ (á˜áŸáŠá¶á™á”áŸ’ášá¶á€áŸ‹)</h3>
        <div class="grid-container" id="groupGood"></div>

        <h3 class="group-title late-border">â° á€áŸ’ášá»á˜á˜á€á€áŸ’ášáŸ„á™á˜áŸ‰áŸ„á„ áŸ§:áŸ áŸ¥ (á™áºá)</h3>
        <div class="grid-container" id="groupLate"></div>
    </div>
</div>

<script>
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {header: 1});
            processData(rows);
        };
        reader.readAsArrayBuffer(file);
    });

    function processData(rows) {
        let results = [];
        // á…á¶á”áŸ‹á•áŸ’áŠá¾á˜á¢á¶á“á–á¸á‡á½ášá‘á¸ áŸ¨ (index 7) áŠá¼á…á€áŸ’á“á»á„ File ášá”áŸáŸ‹á¢áŸ’á“á€
        for (let i = 7; i < rows.length; i++) {
            let row = rows[i];
            let name = row[2]; // Column C: Name
            if (!name) continue;

            let cat1 = 0, cat2 = 0, cat3 = 0;
            // Column á˜áŸ‰áŸ„á„á…á¼á›: G, I, K, M, O (index 6, 8, 10, 12, 14)
            [6, 8, 10, 12, 14].forEach(colIdx => {
                let time = row[colIdx];
                if (time && time !== 'P' && time !== 'A') {
                    let totalMinutes = parseTimeToMinutes(time);
                    if (totalMinutes <= 420) cat1++; // 7:00 AM
                    else if (totalMinutes <= 425) cat2++; // 7:05 AM
                    else cat3++;
                }
            });

            results.push({ name, cat1, cat2, cat3 });
        }
        renderGroups(results);
    }

    function parseTimeToMinutes(timeStr) {
        try {
            // á”áŸ†á”áŸ‚á€á˜áŸ‰áŸ„á„á–á¸á‘á˜áŸ’ášá„áŸ‹ "7:04:51 AM"
            let [time, modifier] = timeStr.split(' ');
            let [hours, minutes] = time.split(':');
            let h = parseInt(hours);
            let m = parseInt(minutes);
            if (modifier === 'PM' && h < 12) h += 12;
            if (modifier === 'AM' && h === 12) h = 0;
            return h * 60 + m;
        } catch (e) { return 999; }
    }

    function renderGroups(data) {
        document.getElementById('results').style.display = 'block';
        const gEx = document.getElementById('groupExcellent');
        const gGo = document.getElementById('groupGood');
        const gLa = document.getElementById('groupLate');

        gEx.innerHTML = ""; gGo.innerHTML = ""; gLa.innerHTML = "";

        data.forEach(staff => {
            let avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(staff.name)}&background=random&size=128`;
            
            // á”á„áŸ’á€á¾á Card áŸá˜áŸ’ášá¶á”áŸ‹á˜áŸ’á“á¶á€áŸ‹áŸ—
            const createCard = (count, bgClass, label) => `
                <div class="staff-card">
                    <div class="avatar"><img src="${avatarUrl}"></div>
                    <span class="name">${staff.name}</span>
                    <span class="count-badge ${bgClass}">${count} ááŸ’á„áŸƒ (${label})</span>
                </div>
            `;

            if (staff.cat1 > 0) gEx.innerHTML += createCard(staff.cat1, 'bg-excellent', 'á˜á»á“ 7:00');
            if (staff.cat2 > 0) gGo.innerHTML += createCard(staff.cat2, 'bg-good', 'á˜á»á“ 7:05');
            if (staff.cat3 > 0) gLa.innerHTML += createCard(staff.cat3, 'bg-late', 'á€áŸ’ášáŸ„á™ 7:05');
        });
    }
</script>

</body>
</html>
